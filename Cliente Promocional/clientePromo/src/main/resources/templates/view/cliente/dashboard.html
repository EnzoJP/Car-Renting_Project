<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title th:text="${titulo ?: 'Dashboard'}">Mi Dashboard - Sprint</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/bootstrap/css/bootstrap.min.css}">
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/bootstrap/css/style.css}">
    <!-- Responsive CSS -->
    <link rel="stylesheet" th:href="@{/bootstrap/css/responsive.css}">
    <!-- Favicon -->
    <link rel="icon" th:href="@{/images/fevicon.png}" type="image/gif">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Raleway:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">

    <style>
        body {
            font-family: 'Raleway', sans-serif;
            background-color: #f8f9fa;
        }

        .dashboard-container {
            padding-top: 30px;
            padding-bottom: 60px;
        }

        .profile-card {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            transition: transform 0.3s ease;
        }

        .profile-card:hover {
            transform: translateY(-5px);
        }

        .profile-pic {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #fe5b29;
            margin-bottom: 20px;
        }

        .profile-card h4 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: #252525;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .profile-card hr {
            border-top: 2px solid #fe5b29;
            width: 60px;
            margin: 20px auto;
        }

        .saldo-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .saldo-info p {
            font-size: 16px;
            margin-bottom: 10px;
            color: #666;
        }

        .saldo-amount {
            font-size: 32px;
            font-weight: 700;
            color: #fe5b29;
        }

        .btn-brand {
            background-color: #fe5b29;
            color: #ffffff;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-brand:hover {
            background-color: #e54a1f;
            color: #ffffff;
            transform: scale(1.05);
        }

        .history-section {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 30px;
        }

        .history-section h2 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: #252525;
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 15px;
        }

        .history-section h2:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background-color: #fe5b29;
        }

        .table {
            margin-top: 20px;
        }

        .table thead {
            background-color: #252525;
            color: #ffffff;
        }

        .table thead th {
            border: none;
            padding: 15px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        .table tbody tr {
            transition: background-color 0.3s ease;
        }

        .table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .table tbody td {
            padding: 15px;
            vertical-align: middle;
            color: #666;
        }

        .btn-download {
            background-color: #252525;
            color: #ffffff;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .btn-download:hover {
            background-color: #fe5b29;
            color: #ffffff;
            transform: scale(1.05);
        }

        .empty-state {
            padding: 40px;
            text-align: center;
            color: #999;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .profile-card {
                margin-bottom: 20px;
            }

            .history-section {
                margin-top: 20px;
            }

            .table-responsive {
                font-size: 14px;
            }

            .profile-pic {
                width: 100px;
                height: 100px;
            }

            .profile-card h4 {
                font-size: 20px;
            }

            .saldo-amount {
                font-size: 24px;
            }
        }

        @media (max-width: 576px) {
            .dashboard-container {
                padding-top: 20px;
            }

            .profile-card,
            .history-section {
                padding: 20px;
            }

            .btn-brand {
                padding: 10px 20px;
                font-size: 14px;
            }

            .table thead th,
            .table tbody td {
                padding: 10px 5px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>

<div th:replace="~{view/cliente/components/navbar :: nav_bar_cliente}"></div>

<div class="container dashboard-container" th:with="total=${#aggregates.sum(alquileres.![costo ?: 0])}">
    <div class="row">

        <!-- PERFIL DEL CLIENTE -->
        <div class="col-lg-4 col-md-12">
            <div class="profile-card">

                <!-- Imagen de perfil -->
                <img th:if="${cliente != null and cliente.imagen != null}"
                     th:src="@{/cliente/mi-imagen}"
                     alt="Foto de Perfil"
                     class="profile-pic">

                <img th:if="${cliente == null or cliente.imagen == null}"
                     th:src="@{/images/client-img1.png}"
                     alt="Foto de Perfil"
                     class="profile-pic">

                <!-- Nombre -->
                <h4 th:text="'¡Hola, ' + (${cliente?.nombre} ?: 'Usuario') + '!'">
                    ¡Hola, Cliente!
                </h4>

                <hr>

                <!-- Saldo -->
                <div class="saldo-info">
                    <p class="mb-2">Saldo Pendiente</p>
                    <div class="saldo-amount" th:text="'$' + ${total}">
                        $0.00
                    </div>
                </div>

                <a href="#" class="btn btn-brand w-100 mt-3">
                    <i class="fa fa-money"></i> Pagar con Billetera Virtual
                </a>
            </div>
        </div>

        <!-- HISTORIAL DE ALQUILERES -->
        <div class="col-lg-8 col-md-12">
            <div class="history-section">
                <h2>Mi Historial de Alquileres</h2>

                <!-- DEBUG: Mostrar cantidad -->
                <p th:text="'Total alquileres: ' + ${alquileres != null ? alquileres.size() : 0}"></p>

                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Vehículo</th>
                            <th>Desde</th>
                            <th>Hasta</th>
                            <th>Total</th>
                            <th class="text-center">Factura</th>
                        </tr>
                        </thead>
                        <tbody>

                        <!-- Sin alquileres -->
                        <tr th:if="${alquileres == null or #lists.isEmpty(alquileres)}">
                            <td colspan="6">
                                <div class="empty-state">
                                    <i class="fa fa-car"></i>
                                    <p>Aún no tienes alquileres registrados.</p>
                                    <small>¡Empieza tu aventura alquilando un vehículo!</small>
                                </div>
                            </td>
                        </tr>

                        <!-- Con alquileres -->
                        <tr th:each="alquiler : ${alquileres}">
                            <!-- ID para debug -->
                            <td th:text="${alquiler.id}">-</td>

                            <td>
                                <!-- Simplificado para debug -->
                                <span th:if="${alquiler.vehiculo != null and alquiler.vehiculo.caracteristicaVehiculo != null}"
                                      th:text="${alquiler.vehiculo.caracteristicaVehiculo.marca} + ' ' + ${alquiler.vehiculo.caracteristicaVehiculo.modelo}">
                            Vehículo
                        </span>
                                <span th:if="${alquiler.vehiculo == null or alquiler.vehiculo.caracteristicaVehiculo == null}">
                            Sin datos
                        </span>
                            </td>

                            <td>
                        <span th:if="${alquiler.fechaDesde != null}"
                              th:text="${#dates.format(alquiler.fechaDesde, 'dd/MM/yyyy')}">-</span>
                                <span th:if="${alquiler.fechaDesde == null}">-</span>
                            </td>

                            <td>
                        <span th:if="${alquiler.fechaHasta != null}"
                              th:text="${#dates.format(alquiler.fechaHasta, 'dd/MM/yyyy')}">-</span>
                                <span th:if="${alquiler.fechaHasta == null}">-</span>
                            </td>

                            <td>
                                <strong th:text="'$' + ${alquiler.costo != null ? alquiler.costo : 0}">$0.00</strong>
                            </td>

                            <td class="text-center">
                        <span th:if="${alquiler.documentacion != null}">
                            <a th:href="@{/cliente/factura/{id}(id=${alquiler.id})}"
                               class="btn btn-download"
                               title="Descargar Factura">
                                <i class="fa fa-download"></i> Descargar
                            </a>
                        </span>
                                <span th:if="${alquiler.documentacion == null}" class="text-muted">
                            <small>Sin factura</small>
                        </span>
                            </td>
                        </tr>

                        </tbody>
                        <tfoot th:if="${alquileres != null and !#lists.isEmpty(alquileres)}">
                        <tr>
                            <td colspan="4" class="text-right"><strong>Total General:</strong></td>
                            <td><strong th:text="'$' + ${total}">$0.00</strong></td>
                            <td></td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

    </div>

</div>

<div th:replace="~{view/cliente/components/footerDash :: footer_dash}"></div>

<!-- Javascript Files -->
<script th:src="@{/bootstrap/js/jquery.min.js}"></script>
<script th:src="@{/bootstrap/js/popper.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>

</body>
</html>